/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 12.0 		*/
/*  Created On : 01-lis-2017 18:04:15 				*/
/*  DBMS       : Oracle 						*/
/* ---------------------------------------------------- */

/* Drop Triggers, Sequences for Autonumber Columns */

DROP TRIGGER "TRG_WNIOSEK_ID"; 
DROP SEQUENCE "SEQ_WNIOSEK_ID"; 
DROP TRIGGER "TRG_UZYTKOWNIK_ID"; 
DROP SEQUENCE "SEQ_UZYTKOWNIK_ID"; 
DROP TRIGGER "TRG_U_WNIOSEK_ID"; 
DROP SEQUENCE "SEQ_U_WNIOSEK_ID"; 
DROP TRIGGER "TRG_U_PRZEDMIOT_ID"; 
DROP SEQUENCE "SEQ_U_PRZEDMIOT_ID"; 
DROP TRIGGER "TRG_STYPENDIA_ID"; 
DROP SEQUENCE "SEQ_STYPENDIA_ID"; 
DROP TRIGGER "TRG_PRZEDMIOT_ID"; 
DROP SEQUENCE "SEQ_PRZEDMIOT_ID"; 


DROP TABLE "WNIOSEK" CASCADE CONSTRAINTS
;

DROP TABLE "UZYTKOWNIK" CASCADE CONSTRAINTS
;

DROP TABLE "U_WNIOSEK" CASCADE CONSTRAINTS
;

DROP TABLE "U_PRZEDMIOT" CASCADE CONSTRAINTS
;

DROP TABLE "STYPENDIA" CASCADE CONSTRAINTS
;

DROP TABLE "PRZEDMIOT" CASCADE CONSTRAINTS
;

/* Create Tables */

CREATE TABLE "WNIOSEK"
(
	"ID" NUMBER(19) NOT NULL,
	"TYP" NUMBER(2) NOT NULL,    -- 0 - stypendium  1 - przed³u¿enie sesji  2 - warunek  3 - egzamin komisyjny
	"WZOR" BLOB
)
;

CREATE TABLE "UZYTKOWNIK"
(
	"ID" NUMBER(19) NOT NULL,
	"IMIE" VARCHAR2(50) NOT NULL,
	"NAZWISKO" VARCHAR2(50) NOT NULL,
	"LOGIN" VARCHAR2(50) NOT NULL,
	"PASS" VARCHAR2(50) NOT NULL,
	"STATUS" VARCHAR2(50) NOT NULL,    -- 0 - aktywny  1 - zablokowany  2 - wymuszenie zmiany has³a 3 - zalogowany
	"EMAIL" VARCHAR2(50) NOT NULL,
	"DATA_UR" DATE NOT NULL,
	"ULICA" VARCHAR2(50) NOT NULL,
	"NR_DOMU" VARCHAR2(5) NOT NULL,
	"NR_MIESZKANIA" VARCHAR2(5) NOT NULL,
	"MIASTO" VARCHAR2(50) NOT NULL,
	"KOD_POCZTOWY" VARCHAR2(6) NOT NULL,
	"PLEC" NUMBER(1) NOT NULL,
	"ROLA" NUMBER(1) NOT NULL    -- 0-student 1-wykladowca 2-administrator
)
;

CREATE TABLE "U_WNIOSEK"
(
	"ID" NUMBER(19) NOT NULL,
	"UZYTKOWNIK_ID" NUMBER(19) NOT NULL,
	"WNIOSEK_ID" NUMBER(19) NOT NULL,
	"WNIOSEK_ZLOZONY" BLOB,
	"DATA_ZLOZENIA" DATE NOT NULL,
	"STATUS" NUMBER(1) NOT NULL,
	"DATA_ROZPATRZENIA" DATE    -- 0 - oczekuj¹cy  1 - w trakcie rozpatrywania  2 - zaakceptowany  3 - odrzucony
)
;

CREATE TABLE "U_PRZEDMIOT"
(
	"ID" NUMBER(19) NOT NULL,
	"DATA_SEMESTRU" DATE,    -- prezentacja wg algorytmu je¿eli data z pierwszego pó³rocza prezentacja SEMESTR LETNI yaer(data_semestru) / yaer(data_semestru) -1 a w przeciwnym razie SEMESTR ZIMOWY yaer(data_semestru) / yaer(data_semestru) +1
	"UZYTKOWNIK_ID" NUMBER(19) NOT NULL,
	"PRZEDMIOT_ID" NUMBER(19) NOT NULL,
	"OCENA1" NUMBER(2,1),
	"OCENA2" NUMBER(2,1)
)
;

CREATE TABLE "STYPENDIA"
(
	"ID" NUMBER(19) NOT NULL,
	"U_WNIOSEK_ID" NUMBER(19) NOT NULL,
	"KWOTA" NUMBER(6,2) NOT NULL
)
;

CREATE TABLE "PRZEDMIOT"
(
	"ID" NUMBER(19) NOT NULL,
	"NAZWA" VARCHAR2(50) NOT NULL
)
;

/* Create Comments, Sequences and Triggers for Autonumber Columns */

COMMENT ON COLUMN "WNIOSEK"."TYP" IS '0 - stypendium  1 - przed³u¿enie sesji  2 - warunek  3 - egzamin komisyjny'
;

CREATE SEQUENCE "SEQ_WNIOSEK_ID" 
	INCREMENT BY 1 
	START WITH 1 
	NOMAXVALUE 
	MINVALUE  1 
	NOCYCLE 
	NOCACHE 
	NOORDER
;

CREATE OR REPLACE TRIGGER "TRG_WNIOSEK_ID" 
	BEFORE INSERT 
	ON "WNIOSEK" 
	FOR EACH ROW 
	BEGIN 
		SELECT "SEQ_WNIOSEK_ID".NEXTVAL 
		INTO :NEW."ID" 
		FROM DUAL; 
	END;
;
/


COMMENT ON COLUMN "UZYTKOWNIK"."STATUS" IS '0 - aktywny  1 - zablokowany  2 - wymuszenie zmiany has³a 3 - zalogowany'
;

COMMENT ON COLUMN "UZYTKOWNIK"."ROLA" IS '0-student 1-wykladowca 2-administrator'
;

CREATE SEQUENCE "SEQ_UZYTKOWNIK_ID" 
	INCREMENT BY 1 
	START WITH 1 
	NOMAXVALUE 
	MINVALUE  1 
	NOCYCLE 
	NOCACHE 
	NOORDER
;

CREATE OR REPLACE TRIGGER "TRG_UZYTKOWNIK_ID" 
	BEFORE INSERT 
	ON "UZYTKOWNIK" 
	FOR EACH ROW 
	BEGIN 
		SELECT "SEQ_UZYTKOWNIK_ID".NEXTVAL 
		INTO :NEW."ID" 
		FROM DUAL; 
	END;
;
/


COMMENT ON COLUMN "U_WNIOSEK"."DATA_ROZPATRZENIA" IS '0 - oczekuj¹cy  1 - w trakcie rozpatrywania  2 - zaakceptowany  3 - odrzucony'
;

CREATE SEQUENCE "SEQ_U_WNIOSEK_ID" 
	INCREMENT BY 1 
	START WITH 1 
	NOMAXVALUE 
	MINVALUE  1 
	NOCYCLE 
	NOCACHE 
	NOORDER
;

CREATE OR REPLACE TRIGGER "TRG_U_WNIOSEK_ID" 
	BEFORE INSERT 
	ON "U_WNIOSEK" 
	FOR EACH ROW 
	BEGIN 
		SELECT "SEQ_U_WNIOSEK_ID".NEXTVAL 
		INTO :NEW."ID" 
		FROM DUAL; 
	END;
;
/


COMMENT ON COLUMN "U_PRZEDMIOT"."DATA_SEMESTRU" IS 'prezentacja wg algorytmu je¿eli data z pierwszego pó³rocza prezentacja SEMESTR LETNI yaer(data_semestru) / yaer(data_semestru) -1 a w przeciwnym razie SEMESTR ZIMOWY yaer(data_semestru) / yaer(data_semestru) +1'
;

CREATE SEQUENCE "SEQ_U_PRZEDMIOT_ID" 
	INCREMENT BY 1 
	START WITH 1 
	NOMAXVALUE 
	MINVALUE  1 
	NOCYCLE 
	NOCACHE 
	NOORDER
;

CREATE OR REPLACE TRIGGER "TRG_U_PRZEDMIOT_ID" 
	BEFORE INSERT 
	ON "U_PRZEDMIOT" 
	FOR EACH ROW 
	BEGIN 
		SELECT "SEQ_U_PRZEDMIOT_ID".NEXTVAL 
		INTO :NEW."ID" 
		FROM DUAL; 
	END;
;
/


CREATE SEQUENCE "SEQ_STYPENDIA_ID" 
	INCREMENT BY 1 
	START WITH 1 
	NOMAXVALUE 
	MINVALUE  1 
	NOCYCLE 
	NOCACHE 
	NOORDER
;

CREATE OR REPLACE TRIGGER "TRG_STYPENDIA_ID" 
	BEFORE INSERT 
	ON "STYPENDIA" 
	FOR EACH ROW 
	BEGIN 
		SELECT "SEQ_STYPENDIA_ID".NEXTVAL 
		INTO :NEW."ID" 
		FROM DUAL; 
	END;
;
/


CREATE SEQUENCE "SEQ_PRZEDMIOT_ID" 
	INCREMENT BY 1 
	START WITH 1 
	NOMAXVALUE 
	MINVALUE  1 
	NOCYCLE 
	NOCACHE 
	NOORDER
;

CREATE OR REPLACE TRIGGER "TRG_PRZEDMIOT_ID" 
	BEFORE INSERT 
	ON "PRZEDMIOT" 
	FOR EACH ROW 
	BEGIN 
		SELECT "SEQ_PRZEDMIOT_ID".NEXTVAL 
		INTO :NEW."ID" 
		FROM DUAL; 
	END;
;
/


/* Create Primary Keys, Indexes, Uniques, Checks, Triggers */

ALTER TABLE "WNIOSEK" 
 ADD CONSTRAINT "PK_TABLE5"
	PRIMARY KEY ("ID")
;

ALTER TABLE "WNIOSEK" 
 ADD CONSTRAINT "CH_TYP" CHECK (typ in (0,1,2,3))
;

ALTER TABLE "UZYTKOWNIK" 
 ADD CONSTRAINT "PK_Table1"
	PRIMARY KEY ("ID")
;

ALTER TABLE "UZYTKOWNIK" 
 ADD CONSTRAINT "CH_STATUS" CHECK (status in (0,1,2,3))
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "PK_TABLE6" UNIQUE ("ID")
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "CH_STATUS_W" CHECK (status in (0,1,2,3))
;

CREATE INDEX "IXFK_U_WNIOSEK_UZYTKOWNIK"   
 ON "U_WNIOSEK" ("UZYTKOWNIK_ID") 
;

CREATE INDEX "IXFK_U_WNIOSEK_WNIOSEK"   
 ON "U_WNIOSEK" ("WNIOSEK_ID") 
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "PK_TABLE4"
	PRIMARY KEY ("ID")
;

CREATE INDEX "IXFK_U_PRZEDMIOT_PRZEDMIOT"   
 ON "U_PRZEDMIOT" ("PRZEDMIOT_ID") 
;

CREATE INDEX "IXFK_U_PRZEDMIOT_UZYTKOWNIK"   
 ON "U_PRZEDMIOT" ("UZYTKOWNIK_ID") 
;

ALTER TABLE "STYPENDIA" 
 ADD CONSTRAINT "PK_TABLE7"
	PRIMARY KEY ("ID")
;

CREATE INDEX "IXFK_STYPENDIA_U_WNIOSEK"   
 ON "STYPENDIA" ("U_WNIOSEK_ID") 
;

ALTER TABLE "PRZEDMIOT" 
 ADD CONSTRAINT "PK_TABLE3"
	PRIMARY KEY ("ID")
;

/* Create Foreign Key Constraints */

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "FK_U_WNIOSEK_UZYTKOWNIK"
	FOREIGN KEY ("UZYTKOWNIK_ID") REFERENCES "UZYTKOWNIK" ("ID")
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "FK_U_WNIOSEK_WNIOSEK"
	FOREIGN KEY ("WNIOSEK_ID") REFERENCES "WNIOSEK" ("ID")
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "FK_U_PRZEDMIOT_PRZEDMIOT"
	FOREIGN KEY ("PRZEDMIOT_ID") REFERENCES "PRZEDMIOT" ("ID")
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "FK_U_PRZEDMIOT_UZYTKOWNIK"
	FOREIGN KEY ("UZYTKOWNIK_ID") REFERENCES "UZYTKOWNIK" ("ID")
;

ALTER TABLE "STYPENDIA" 
 ADD CONSTRAINT "FK_STYPENDIA_U_WNIOSEK"
	FOREIGN KEY ("U_WNIOSEK_ID") REFERENCES "U_WNIOSEK" ("ID")
;
