/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 12.0 		*/
/*  Created On : 12-gru-2017 19:02:06 				*/
/*  DBMS       : Oracle 						*/
/* ---------------------------------------------------- */

/* Drop Tables */

DROP TABLE "WNIOSEK" CASCADE CONSTRAINTS
;

DROP TABLE "UZYTKOWNIK" CASCADE CONSTRAINTS
;

DROP TABLE "U_WNIOSEK" CASCADE CONSTRAINTS
;

DROP TABLE "U_PRZEDMIOT" CASCADE CONSTRAINTS
;

DROP TABLE "STYPENDIA" CASCADE CONSTRAINTS
;

DROP TABLE "PRZEDMIOT" CASCADE CONSTRAINTS
;

/* Create Tables */

CREATE TABLE "WNIOSEK"
(
	"ID" NUMBER(19) NOT NULL,
	"TYP" NUMBER(2) NOT NULL,    -- 0 - stypendium  1 - przed³u¿enie sesji  2 - warunek  3 - egzamin komisyjny
	"WZOR" BLOB
)
;

CREATE TABLE "UZYTKOWNIK"
(
	"ID" NUMBER(19) NOT NULL,
	"IMIE" VARCHAR2(50) NOT NULL,
	"NAZWISKO" VARCHAR2(50) NOT NULL,
	"LOGIN" VARCHAR2(50) NOT NULL,
	"PASS" VARCHAR2(50) NOT NULL,
	"AKTYWNY" NUMBER(1) NOT NULL,    -- 0 - aktywny  1 - zablokowany  2 - wymuszenie zmiany has³a 3 - zalogowany
	"EMAIL" VARCHAR2(50) NOT NULL,
	"DATA_UR" DATE NOT NULL,
	"ULICA" VARCHAR2(50) NOT NULL,
	"NR_DOMU" VARCHAR2(5) NOT NULL,
	"NR_MIESZKANIA" VARCHAR2(5) NOT NULL,
	"MIASTO" VARCHAR2(50) NOT NULL,
	"KOD_POCZT" VARCHAR2(6) NOT NULL,
	"PLEC" VARCHAR2(1) NOT NULL,
	"ROLA" NUMBER(1) NOT NULL,    -- 0-student 1-wykladowca 2-administrator
	"ILOSC_LOGOWAN" NUMBER(5) NOT NULL
)
;

CREATE TABLE "U_WNIOSEK"
(
	"ID" NUMBER(19) NOT NULL,
	"UZYTKOWNIK_ID" NUMBER(19) NOT NULL,
	"WNIOSEK_ID" NUMBER(19) NOT NULL,
	"WNIOSEK_ZLOZONY" BLOB,
	"DATA_ZLOZENIA" DATE NOT NULL,
	"STATUS" NUMBER(1) NOT NULL,
	"DATA_ROZPATRZENIA" DATE    -- 0 - oczekuj¹cy  1 - w trakcie rozpatrywania  2 - zaakceptowany  3 - odrzucony
)
;

CREATE TABLE "U_PRZEDMIOT"
(
	"ID" NUMBER(19) NOT NULL,
	"DATA_SEMESTRU" DATE,    -- prezentacja wg algorytmu je¿eli data z pierwszego pó³rocza prezentacja SEMESTR LETNI yaer(data_semestru) / yaer(data_semestru) -1 a w przeciwnym razie SEMESTR ZIMOWY yaer(data_semestru) / yaer(data_semestru) +1
	"UZYTKOWNIK_ID" NUMBER(19) NOT NULL,
	"PRZEDMIOT_ID" NUMBER(19) NOT NULL,
	"OCENA1" NUMBER(2,1),
	"OCENA2" NUMBER(2,1)
)
;

CREATE TABLE "STYPENDIA"
(
	"ID" NUMBER(19) NOT NULL,
	"U_WNIOSEK_ID" NUMBER(19) NOT NULL,
	"KWOTA" NUMBER(6,2) NOT NULL
)
;

CREATE TABLE "PRZEDMIOT"
(
	"ID" NUMBER(19) NOT NULL,
	"NAZWA" VARCHAR2(50) NOT NULL
)
;

/* Create Comments, Sequences and Triggers for Autonumber Columns */

COMMENT ON COLUMN "WNIOSEK"."TYP" IS '0 - stypendium  1 - przed³u¿enie sesji  2 - warunek  3 - egzamin komisyjny'
;

COMMENT ON COLUMN "UZYTKOWNIK"."AKTYWNY" IS '0 - aktywny  1 - zablokowany  2 - wymuszenie zmiany has³a 3 - zalogowany'
;

COMMENT ON COLUMN "UZYTKOWNIK"."ROLA" IS '0-student 1-wykladowca 2-administrator'
;

COMMENT ON COLUMN "U_WNIOSEK"."DATA_ROZPATRZENIA" IS '0 - oczekuj¹cy  1 - w trakcie rozpatrywania  2 - zaakceptowany  3 - odrzucony'
;

COMMENT ON COLUMN "U_PRZEDMIOT"."DATA_SEMESTRU" IS 'prezentacja wg algorytmu je¿eli data z pierwszego pó³rocza prezentacja SEMESTR LETNI yaer(data_semestru) / yaer(data_semestru) -1 a w przeciwnym razie SEMESTR ZIMOWY yaer(data_semestru) / yaer(data_semestru) +1'
;

/* Create Primary Keys, Indexes, Uniques, Checks, Triggers */

ALTER TABLE "WNIOSEK" 
 ADD CONSTRAINT "PK_TABLE5"
	PRIMARY KEY ("ID")
;

ALTER TABLE "WNIOSEK" 
 ADD CONSTRAINT "CH_TYP" CHECK (typ in (0,1,2,3))
;

ALTER TABLE "UZYTKOWNIK" 
 ADD CONSTRAINT "PK_Table1"
	PRIMARY KEY ("ID")
;

ALTER TABLE "UZYTKOWNIK" 
 ADD CONSTRAINT "CH_STATUS" CHECK (status in (0,1,2,3))
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "PK_TABLE6" UNIQUE ("ID")
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "CH_STATUS_W" CHECK (status in (0,1,2,3))
;

CREATE INDEX "IXFK_U_WNIOSEK_UZYTKOWNIK"   
 ON "U_WNIOSEK" ("UZYTKOWNIK_ID") 
;

CREATE INDEX "IXFK_U_WNIOSEK_WNIOSEK"   
 ON "U_WNIOSEK" ("WNIOSEK_ID") 
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "PK_TABLE4"
	PRIMARY KEY ("ID")
;

CREATE INDEX "IXFK_U_PRZEDMIOT_PRZEDMIOT"   
 ON "U_PRZEDMIOT" ("PRZEDMIOT_ID") 
;

CREATE INDEX "IXFK_U_PRZEDMIOT_UZYTKOWNIK"   
 ON "U_PRZEDMIOT" ("UZYTKOWNIK_ID") 
;
CREATE UNIQUE INDEX "PPLCADM"."IXUQ_U_PRZEDMIOT" 
ON "U_PRZEDMIOT" ("DATA_SEMESTRU", "UZYTKOWNIK_ID", "PRZEDMIOT_ID");
  
ALTER TABLE "STYPENDIA" 
 ADD CONSTRAINT "PK_TABLE7"
	PRIMARY KEY ("ID")
;

CREATE INDEX "IXFK_STYPENDIA_U_WNIOSEK"   
 ON "STYPENDIA" ("U_WNIOSEK_ID") 
;

ALTER TABLE "PRZEDMIOT" 
 ADD CONSTRAINT "PK_TABLE3"
	PRIMARY KEY ("ID")
;

/* Create Foreign Key Constraints */

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "FK_U_WNIOSEK_UZYTKOWNIK"
	FOREIGN KEY ("UZYTKOWNIK_ID") REFERENCES "UZYTKOWNIK" ("ID")
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "FK_U_WNIOSEK_WNIOSEK"
	FOREIGN KEY ("WNIOSEK_ID") REFERENCES "WNIOSEK" ("ID")
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "FK_U_PRZEDMIOT_PRZEDMIOT"
	FOREIGN KEY ("PRZEDMIOT_ID") REFERENCES "PRZEDMIOT" ("ID")
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "FK_U_PRZEDMIOT_UZYTKOWNIK"
	FOREIGN KEY ("UZYTKOWNIK_ID") REFERENCES "UZYTKOWNIK" ("ID")
;

ALTER TABLE "STYPENDIA" 
 ADD CONSTRAINT "FK_STYPENDIA_U_WNIOSEK"
	FOREIGN KEY ("U_WNIOSEK_ID") REFERENCES "U_WNIOSEK" ("ID")
;
CREATE SEQUENCE   SEQ_u_przedmiot  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 5 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_u_wniosek  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 5 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_przedmiot  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 5 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_wniosek  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 5 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_stypendia  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 5 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_uzytkownik  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 5 NOCACHE  NOORDER  NOCYCLE ;

