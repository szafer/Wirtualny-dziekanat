/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 12.0 		*/
/*  Created On : 12-gru-2017 19:02:06 				*/
/*  DBMS       : Oracle 						*/
/* ---------------------------------------------------- */

/* Drop Tables */

DROP TABLE "WNIOSEK" CASCADE CONSTRAINTS
;

DROP TABLE "UZYTKOWNIK" CASCADE CONSTRAINTS
;

DROP TABLE "U_WNIOSEK" CASCADE CONSTRAINTS
;

DROP TABLE "U_PRZEDMIOT" CASCADE CONSTRAINTS
;
DROP TABLE "ODBIORCA" CASCADE CONSTRAINTS
;
DROP TABLE "PRZEDMIOT" CASCADE CONSTRAINTS
;
DROP TABLE "NADAWCA" CASCADE CONSTRAINTS
;
DROP TABLE "INSTRUKCJA" CASCADE CONSTRAINTS
;
DROP SEQUENCE   SEQ_u_przedmiot ;
DROP SEQUENCE   SEQ_u_wniosek  ;
DROP SEQUENCE   SEQ_przedmiot  ;
DROP SEQUENCE   SEQ_wniosek ;
DROP SEQUENCE   SEQ_uzytkownik  ;
DROP SEQUENCE   SEQ_nadawca  ;
DROP SEQUENCE   SEQ_odbiorca  ;
DROP SEQUENCE   SEQ_instrukcja  ;
/* Create Tables */

CREATE TABLE "WNIOSEK"
(
	"ID" NUMBER(19) NOT NULL,
	"TYP" NUMBER(2) NOT NULL,    -- 0 - stypendium  1 - przed³u¿enie sesji  2 - warunek  3 - egzamin komisyjny
	"WZOR" BLOB,
	"NAZWA_OBRAZU" VARCHAR2(50)
)
;

CREATE TABLE "UZYTKOWNIK"
(
	"ID" NUMBER(19) NOT NULL,
	"IMIE" VARCHAR2(50) NOT NULL,
	"NAZWISKO" VARCHAR2(50) NOT NULL,
	"LOGIN" VARCHAR2(50) NOT NULL,
	"PASS" VARCHAR2(50) NOT NULL,
	"AKTYWNY" NUMBER(1) NOT NULL,    -- 0 - aktywny  1 - zablokowany  2 - wymuszenie zmiany has³a 3 - zalogowany
	"EMAIL" VARCHAR2(50) NOT NULL,
	"DATA_UR" DATE NOT NULL,
	"ULICA" VARCHAR2(50) NOT NULL,
	"NR_DOMU" VARCHAR2(5) NOT NULL,
	"NR_MIESZKANIA" VARCHAR2(5) NOT NULL,
	"MIASTO" VARCHAR2(50) NOT NULL,
	"KOD_POCZT" VARCHAR2(6) NOT NULL,
	"PLEC" NUMBER(1) NOT NULL,    -- 0-mezczyzna 1-kobieta
	"ROLA" NUMBER(1) NOT NULL,    -- 0-student 1-wykladowca 2-administrator
	"ILOSC_LOGOWAN" NUMBER(5) NOT NULL
)
;

CREATE TABLE "U_WNIOSEK"
(
	"ID" NUMBER(19) NOT NULL,
	"UZYTKOWNIK_ID" NUMBER(19) NOT NULL,
	"WNIOSEK_ID" NUMBER(19) NOT NULL,
	"WNIOSEK_ZLOZONY" BLOB,
	"DATA_ZLOZENIA" DATE NOT NULL,
	"STATUS" NUMBER(1) NOT NULL,
	"DATA_ROZPATRZENIA" DATE,    -- 0 - oczekuj¹cy  1 - w trakcie rozpatrywania  2 - zaakceptowany  3 - odrzucony
	"KWOTA" NUMBER(6,2) NULL
)
;

CREATE TABLE "U_PRZEDMIOT"
(
	"ID" NUMBER(19) NOT NULL,
	"DATA_SEMESTRU" DATE,    -- prezentacja wg algorytmu je¿eli data z pierwszego pó³rocza prezentacja SEMESTR LETNI yaer(data_semestru) / yaer(data_semestru) -1 a w przeciwnym razie SEMESTR ZIMOWY yaer(data_semestru) / yaer(data_semestru) +1
	"UZYTKOWNIK_ID" NUMBER(19) NOT NULL,
	"PRZEDMIOT_ID" NUMBER(19) NOT NULL,
	"OCENA1" NUMBER(2,1),
	"OCENA2" NUMBER(2,1)
)
;



CREATE TABLE "PRZEDMIOT"
(
	"ID" NUMBER(19) NOT NULL,
	"NAZWA" VARCHAR2(50) NOT NULL
)
;

CREATE TABLE "NADAWCA"
(
	"ID" NUMBER(10) NOT NULL,
	"UZYTKOWNIK_ID" NUMBER(10) NOT NULL,
	"TEMAT" VARCHAR2(150) NOT NULL,
	"WIADOMOSC" VARCHAR2(2000) NOT NULL,
	"DATA" DATE NOT NULL
)
;
CREATE TABLE "ODBIORCA"
(
	"ID" NUMBER(10) NOT NULL,
	"UZYTKOWNIK_ID" NUMBER(10) NOT NULL,
	"NADAWCA_ID" NUMBER(10) NOT NULL,
	"ODEBRANO" NUMBER(1),
	"DATA_ODBIORU" DATE,
	"EMAIL" NUMBER(1)
)
;
CREATE TABLE "INSTRUKCJA"
(
	"ID" NUMBER(3) NOT NULL,
	"INSTRUKCJA" BLOB NOT NULL
)
;
 
COMMENT ON TABLE "INSTRUKCJA" IS 'Tablica z dokumentacj¹'
;
COMMENT ON TABLE "ODBIORCA" IS 'Lista odbiorców wiadomoœci z potwierdzeniem odebrania'
;

/* Create Comments, Sequences and Triggers for Autonumber Columns */

COMMENT ON COLUMN "WNIOSEK"."TYP" IS '0 - stypendium  1 - przed³u¿enie sesji  2 - warunek  3 - egzamin komisyjny'
;

COMMENT ON COLUMN "UZYTKOWNIK"."AKTYWNY" IS '0 - aktywny  1 - zablokowany  2 - wymuszenie zmiany has³a 3 - zalogowany'
;

COMMENT ON COLUMN "UZYTKOWNIK"."ROLA" IS '0-student 1-wykladowca 2-administrator'
;

COMMENT ON COLUMN "U_WNIOSEK"."DATA_ROZPATRZENIA" IS '0 - oczekuj¹cy  1 - w trakcie rozpatrywania  2 - zaakceptowany  3 - odrzucony'
;

COMMENT ON COLUMN "U_PRZEDMIOT"."DATA_SEMESTRU" IS 'prezentacja wg algorytmu je¿eli data z pierwszego pó³rocza prezentacja SEMESTR LETNI yaer(data_semestru) / yaer(data_semestru) -1 a w przeciwnym razie SEMESTR ZIMOWY yaer(data_semestru) / yaer(data_semestru) +1'
;
COMMENT ON COLUMN "WNIOSEK"."TYP" IS '0 - stypendium  1 - przed³u¿enie sesji  2 - warunek  3 - egzamin komisyjny'
;


/* Create Primary Keys, Indexes, Uniques, Checks, Triggers */

ALTER TABLE "WNIOSEK" 
 ADD CONSTRAINT "PK_TABLE5"
	PRIMARY KEY ("ID")
;

ALTER TABLE "WNIOSEK" 
 ADD CONSTRAINT "CH_TYP" CHECK (typ in (0,1,2,3))
;

ALTER TABLE "UZYTKOWNIK" 
 ADD CONSTRAINT "PK_Table1u"
	PRIMARY KEY ("ID")
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "PK_TABLE6" UNIQUE ("ID")
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "CH_STATUS_W" CHECK (status in (0,1,2,3))
;

CREATE INDEX "IXFK_U_WNIOSEK_UZYTKOWNIK"   
 ON "U_WNIOSEK" ("UZYTKOWNIK_ID") 
;

CREATE INDEX "IXFK_U_WNIOSEK_WNIOSEK"   
 ON "U_WNIOSEK" ("WNIOSEK_ID") 
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "PK_TABLE4"
	PRIMARY KEY ("ID")
;

CREATE INDEX "IXFK_U_PRZEDMIOT_PRZEDMIOT"   
 ON "U_PRZEDMIOT" ("PRZEDMIOT_ID") 
;

CREATE INDEX "IXFK_U_PRZEDMIOT_UZYTKOWNIK"   
 ON "U_PRZEDMIOT" ("UZYTKOWNIK_ID") 
;
CREATE UNIQUE INDEX "IXUQ_U_PRZEDMIOT" 
ON "U_PRZEDMIOT" ("DATA_SEMESTRU", "UZYTKOWNIK_ID", "PRZEDMIOT_ID");

CREATE UNIQUE INDEX "IDUX_UZYTKOWNIK_EMA" ON "UZYTKOWNIK" ("EMAIL");
CREATE UNIQUE INDEX "IDUX_UZYTKOWNIK_LOG" ON "UZYTKOWNIK" ("LOGIN"); 

ALTER TABLE "PRZEDMIOT" 
 ADD CONSTRAINT "PK_TABLE3"
	PRIMARY KEY ("ID")
;

/* Create Foreign Key Constraints */

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "FK_U_WNIOSEK_UZYTKOWNIK"
	FOREIGN KEY ("UZYTKOWNIK_ID") REFERENCES "UZYTKOWNIK" ("ID")
;

ALTER TABLE "U_WNIOSEK" 
 ADD CONSTRAINT "FK_U_WNIOSEK_WNIOSEK"
	FOREIGN KEY ("WNIOSEK_ID") REFERENCES "WNIOSEK" ("ID")
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "FK_U_PRZEDMIOT_PRZEDMIOT"
	FOREIGN KEY ("PRZEDMIOT_ID") REFERENCES "PRZEDMIOT" ("ID")
;

ALTER TABLE "U_PRZEDMIOT" 
 ADD CONSTRAINT "FK_U_PRZEDMIOT_UZYTKOWNIK"
	FOREIGN KEY ("UZYTKOWNIK_ID") REFERENCES "UZYTKOWNIK" ("ID")
;

ALTER TABLE "NADAWCA" 
 ADD CONSTRAINT "PK_Table1n"
	PRIMARY KEY ("ID")
;

ALTER TABLE "NADAWCA" 
 ADD CONSTRAINT "FK_NADAWCA_UZYTKOWNIK"
	FOREIGN KEY ("UZYTKOWNIK_ID") REFERENCES "UZYTKOWNIK" ("ID")
;
ALTER TABLE  "ODBIORCA" 
 ADD CONSTRAINT "PK_Table1o"
	PRIMARY KEY ("ID")
; 

ALTER TABLE  "ODBIORCA" 
 ADD CONSTRAINT "FK_ODBIORCA_NADAWCA"
	FOREIGN KEY ("NADAWCA_ID") REFERENCES "NADAWCA" ("ID")
;

ALTER TABLE  "ODBIORCA" 
 ADD CONSTRAINT "FK_ODBIORCA_UZYTKOWNIK"
	FOREIGN KEY ("UZYTKOWNIK_ID") REFERENCES "UZYTKOWNIK" ("ID");
	
ALTER TABLE "INSTRUKCJA" 
 ADD CONSTRAINT "PK_Table1i"
	PRIMARY KEY ("ID")
;


CREATE SEQUENCE   SEQ_u_przedmiot  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 3000 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_u_wniosek  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 3000 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_przedmiot  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 3000 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_wniosek  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 3000 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_uzytkownik  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 3000 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_nadawca  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 3000 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_odbiorca  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 3000 NOCACHE  NOORDER  NOCYCLE ;
CREATE SEQUENCE   SEQ_instrukcja  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 3000 NOCACHE  NOORDER  NOCYCLE ;

